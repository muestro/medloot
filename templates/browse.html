{% extends "templates/base.html" %}

{% block title %}Browse{% endblock %}

{% block head %}
    {{ super() }}
    <link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/ui-darkness/jquery-ui.css" />
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
    <script src="/static/home.js"></script>
    <script src="/static/search2.js"></script>
    <link type="text/css" rel="stylesheet" href="/static/search.css" />
    <link type="text/css" rel="stylesheet" href="/static/search2.css" />
{% endblock %}

{% block content %}
<div class="contentContainer" style="margin-top: 15px;">
    <div>
        <!-- filters -->
        <div class="filterWrapper">
            <div class="filterGroupHeading">Filters</div>
            <div class="filterGroup">
                <label>Class:</label>
                <div class="buttonGroup">
                    <button classFilterButton filter="!M">Mage</button>
                    <button classFilterButton filter="!C">Cleric</button>
                    <button classFilterButton filter="!T">Thief</button>
                    <button classFilterButton filter="!W">Warrior</button>
                </div>
            </div>
            <div class="filterGroup">
                <label>Stats:</label>
                <div class="buttonGroup">
                    <button numberFilterButton filter="hp">Hp</button>
                    <button numberFilterButton filter="mana">Mana</button>
                    <button numberFilterButton filter="hr">HR</button>
                    <button numberFilterButton filter="dr">DR</button>
                </div>
            </div>
            <div class="filterGroup">
                <label>Equipable Location:</label>
                <div id="equipableLocationFilterGroup" class="buttonGroup">
                    <!-- javascript fill in dynamically the options -->
                </div>
            </div>
        </div>

        <div />

        {% if items|length > 0 %}
        <table id="resultTable">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Level</th>
                    <th>Location</th>
                    <th>Restrictions</th>
                    <th>Armor</th>
                    <th>HP</th>
                    <th>Mana</th>
                    <th>HR</th>
                    <th>DR</th>
                    <th>Inf_Melee</th>
                    <th>Inf_Spells</th>
                    <th>SS</th>
                    <th>SB</th>
                    <th>SR</th>
                </tr>
            </thead>
            <tbody class="resultList">
                {% for item in items %}
                    {% set hr_max = item.get_max_affect('HITROLL') %}
                    {% set hr_min = item.get_min_affect('HITROLL') %}
                    {% set hr_base = item.get_base_affect('HITROLL') %}

                    {% set dr_max = item.get_max_affect('DAMROLL') %}
                    {% set dr_min = item.get_min_affect('DAMROLL') %}
                    {% set dr_base = item.get_base_affect('DAMROLL') %}

                    {% set hp_max = item.get_max_affect('HIT_POINTS') %}
                    {% set hp_min = item.get_min_affect('HIT_POINTS') %}
                    {% set hp_base = item.get_base_affect('HIT_POINTS') %}

                    {% set mana_max = item.get_max_affect('MANA') %}
                    {% set mana_min = item.get_min_affect('MANA') %}
                    {% set mana_base = item.get_base_affect('MANA') %}

                    {% set infmelee_max = item.get_max_affect('INFLUENCE_MELEE') %}
                    {% set infmelee_min = item.get_min_affect('INFLUENCE_MELEE') %}
                    {% set infmelee_base = item.get_base_affect('INFLUENCE_MELEE') %}

                    {% set infspells_max = item.get_max_affect('INFLUENCE_SPELLS') %}
                    {% set infspells_min = item.get_min_affect('INFLUENCE_SPELLS') %}
                    {% set infspells_base = item.get_base_affect('INFLUENCE_SPELLS') %}

                    {% set ss_max = item.get_max_affect('SAVING_SPELL') %}
                    {% set ss_min = item.get_min_affect('SAVING_SPELL') %}
                    {% set ss_base = item.get_base_affect('SAVING_SPELL') %}

                    {% set sb_max = item.get_max_affect('SAVING_BREATH') %}
                    {% set sb_min = item.get_min_affect('SAVING_BREATH') %}
                    {% set sb_base = item.get_base_affect('SAVING_BREATH') %}

                    {% set sr_max = item.get_max_affect('SAVING_ROD') %}
                    {% set sr_min = item.get_min_affect('SAVING_ROD') %}
                    {% set sr_base = item.get_base_affect('SAVING_ROD') %}


                    {% set oindex = loop.index %}
                    <tr id="resultRow{{ oindex }}-{{ loop.index }}" class="resultRow" rowNum="{{ oindex }}-{{ loop.index }}">
                        <td>{{ item.name }}</td>
                        <td>{% if item.level_restriction != 0 %}{{ item.level_restriction }}{% endif %}</td>
                        <td filter="equipableLocation">
                            {% if item.equipable_locations|length > 1 %}
                                {% for location in item.equipable_locations %}{{location}} <br />{% endfor %}
                            {% else %}
                                {{item.equipable_locations[0]}}
                            {% endif %}
                        </td>
                        <td class="unlit">
                            <span class="{% if item.is_anti_mage() %}lit{% endif %}">!M</span>
                            <span class="{% if item.is_anti_cleric() %}lit{% endif %}">!C</span>
                            <span class="{% if item.is_anti_thief() %}lit{% endif %}">!T</span>
                            <span class="{% if item.is_anti_warrior() %}lit{% endif %}">!W</span>
                        </td>
                        <td>{% if item.ac_apply %}{{item.ac_apply}}{%endif%}</td>
                        <td filter="hp" class="statBlock">
                            {% if hp_max %}
                            <span class="max">{% if hp_base %} {{hp_base}} {% else %} ? {% endif %}</span>
                            <div>
                                <span>{% if hp_max %} {{hp_max}} {% else %} ? {% endif %}</span>
                                <span>{% if hp_min %} {{hp_min}} {% else %} ? {% endif %}</span>
                            </div>
                            {% endif %}
                        </td>
                        <td filter="mana" class="statBlock">
                            {% if mana_max %}
                            <span class="max">{% if mana_base %} {{mana_base}} {% else %} ? {% endif %}</span>
                            <div>
                                <span>{% if mana_max %} {{mana_max}} {% else %} ? {% endif %}</span>
                                <span>{% if mana_min %} {{mana_min}} {% else %} ? {% endif %}</span>
                            </div>
                            {% endif %}
                        </td>
                        <td filter="hr" class="statBlock">
                            {% if hr_max %}
                            <span class="max">{% if hr_base %} {{hr_base}} {% else %} ? {% endif %}</span>
                            <div>
                                <span>{% if hr_max %} {{hr_max}} {% else %} ? {% endif %}</span>
                                <span>{% if hr_min %} {{hr_min}} {% else %} ? {% endif %}</span>
                            </div>
                            {% endif %}
                        </td>
                        <td filter="dr" class="statBlock">
                            {% if dr_max %}
                            <span class="max">{% if dr_base %} {{dr_base}} {% else %} ? {% endif %}</span>
                            <div>
                                <span>{% if dr_max %} {{dr_max}} {% else %} ? {% endif %}</span>
                                <span>{% if dr_min %} {{dr_min}} {% else %} ? {% endif %}</span>
                            </div>
                            {% endif %}
                        </td>
                        <td class="statBlock">
                            {% if infmelee_max %}
                            <span class="max">{% if infmelee_base %} {{infmelee_base}} {% else %} ? {% endif %}</span>
                            <div>
                                <span>{% if infmelee_max %} {{infmelee_max}} {% else %} ? {% endif %}</span>
                                <span>{% if infmelee_min %} {{infmelee_min}} {% else %} ? {% endif %}</span>
                            </div>
                            {% endif %}
                        </td>
                        <td class="statBlock">
                            {% if infspells_max %}
                            <span class="max">{% if infspells_base %} {{infspells_base}} {% else %} ? {% endif %}</span>
                            <div>
                                <span>{% if infspells_max %} {{infspells_max}} {% else %} ? {% endif %}</span>
                                <span>{% if infspells_min %} {{infspells_min}} {% else %} ? {% endif %}</span>
                            </div>
                            {% endif %}
                        </td>
                        <td class="statBlock">
                            {% if ss_max %}
                            <span class="max">{% if ss_base %} {{ss_base}} {% else %} ? {% endif %}</span>
                            <div>
                                <span>{% if ss_max %} {{ss_max}} {% else %} ? {% endif %}</span>
                                <span>{% if ss_min %} {{ss_min}} {% else %} ? {% endif %}</span>
                            </div>
                            {% endif %}
                        </td>
                        <td class="statBlock">
                            {% if sb_max %}
                            <span class="max">{% if sb_base %} {{sb_base}} {% else %} ? {% endif %}</span>
                            <div>
                                <span>{% if sb_max %} {{sb_max}} {% else %} ? {% endif %}</span>
                                <span>{% if sb_min %} {{sb_min}} {% else %} ? {% endif %}</span>
                            </div>
                            {% endif %}
                        </td>
                        <td class="statBlock">
                            {% if sr_max %}
                            <span class="max">{% if sr_base %} {{sr_base}} {% else %} ? {% endif %}</span>
                            <div>
                                <span>{% if sr_max %} {{sr_max}} {% else %} ? {% endif %}</span>
                                <span>{% if sr_min %} {{sr_min}} {% else %} ? {% endif %}</span>
                            </div>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <span style="padding-left: 30px;">Your search did not produce any results.</span>
        {% endif %}
    </div>
</div>
{% endblock %}